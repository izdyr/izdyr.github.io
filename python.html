<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Compiler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/material.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');

*{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body{
    font-family: "Inter", sans-serif;
    background-color: #2e2e2e;
    color: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    min-height: 100vh;
}

.container{
    width: 100%;
    max-width: 700px;
    background: #333;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
}

h1{
    font-size: 20px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 15px;
    color: #fff;
}

#editor-wrapper{
    border: 1px solid #444;
    border-radius: 5px;
    overflow: hidden;
}

.run-btn,
#submit-inputs-btn{
    width: 100%;
    background: #0070f3;
    color: #fff;
    border: none;
    padding: 10px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    margin-top: 15px;
    border-radius: 5px;
    transition: background 0.2s ease;
}

.run-btn:hover,
#submit-inputs-btn:hover{
    background: #0059c9;
}

.output-container{
    margin-top: 15px;
    background: #121212;
    padding: 20px;
    border-radius: 5px;
    font-size: 14px;
    border: 1px solid #444;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #e0e0e0;
    max-height: 360px;
    overflow-y: auto;
}

.CodeMirror{
    height: 260px !important;
    font-size: 14px;
    scrollbar-width: thin;
    scrollbar-color: #444 #2e2e2e;
}

.CodeMirror-vscrollbar div,
.CodeMirror-hscrollbar div{
    background-color: #444;
    border-radius: 10px;
}

.input-group,
#output{
    display: flex;
    flex-direction: column;
    gap: 14px;
    white-space: pre-wrap;
}

.user-input{
    padding: 8px;
    font-size: 16px;
    border: 1px solid #444;
    border-radius: 5px;
    outline: none;
    transition: border-color 0.3s ease-in-out;
    background: #333;
    color: #e0e0e0;
    margin-top: 4px;
}

.user-input:focus{
    border-color: #0070f3;
}

.inputs-container{
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
}
</style>
<body>

    <div class="container">
        <h1>Python Compiler</h1>
        <h4>Made by izadyar</h4>
        <div id="editor-wrapper">
            <textarea id="code"></textarea>
        </div>
        <button class="run-btn">Run</button>
        <div class="output-container">
            <pre id="output">> Output will appear here...</pre>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/python/python.min.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function () {
    // Initialize CodeMirror with Syntax Highlighting
    const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        mode: "python",
        theme: "material",
        lineNumbers: true,
        indentUnit: 4,
        smartIndent: true,
        matchBrackets: true,
        autoCloseBrackets: true,
        lineWrapping: true
    });

    // Default Python Code
    editor.setValue('');

    // Function to compile code with dynamic input handling
    async function compileCode() {
        const code = editor.getValue();
        const outputElement = document.getElementById("output");
        outputElement.textContent = "ðŸ”„ Running...";

        // Check if input() is needed?
        const inputPattern = /input\((?:'|"|`)(.*?)(?:'|"|`)\)/g;
        const inputPrompts = [...code.matchAll(inputPattern)].map(match => match[1]);

        if (inputPrompts.length > 0) {
            // Clear previous content
            outputElement.innerHTML = '<h3>Provide Input:</h3>';

            // Create a container for inputs
            const inputsContainer = document.createElement('div');
            inputsContainer.classList.add('inputs-container');

            inputPrompts.forEach((prompt, index) => {
                const inputGroup = document.createElement('div');
                inputGroup.classList.add('input-group');

                const label = document.createElement('label');
                label.setAttribute('for', `input-${index}`);
                label.textContent = prompt;

                const input = document.createElement('input');
                input.type = 'text';
                input.id = `input-${index}`;
                input.classList.add('user-input');

                // Append label and input to the input group
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);

                // Append input group to the inputs container
                inputsContainer.appendChild(inputGroup);
            });

            // Append inputs container to the output element
            outputElement.appendChild(inputsContainer);

            // Create and append the submit button
            const submitButton = document.createElement('button');
            submitButton.id = 'submit-inputs-btn';
            submitButton.textContent = 'Submit Inputs';
            outputElement.appendChild(submitButton);

            // Attach event listener to the submit button
            submitButton.addEventListener('click', submitInputs);
            return;
        }

        await executeCode(code);
    }

    // Function to Execute Code
    async function executeCode(code, inputs = []) {
        const outputElement = document.getElementById("output");
        outputElement.textContent = "ðŸ”„ Running...";

        // Replace input() calls with provided inputs
        inputs.forEach((input, index) => {
            code = code.replace(/input\((?:'|"|`)(.*?)(?:'|"|`)\)/, `"${input}"`);
        });

        try {
            const response = await fetch("https://emkc.org/api/v2/piston/execute", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    language: "python",
                    version: "3.10.0",
                    files: [{ content: code }]
                })
            });

            if (!response.ok) throw new Error("âš  Error executing code!");

            const result = await response.json();
            const output = result.run.output || "âš  No output!";

            // Add the `>` before the output, mimicking terminal behavior
            outputElement.innerHTML = `> ${output}`;
        } catch (error) {
            outputElement.textContent = "âš  Error: " + error.message;
        }
    }

    // Collect inputs and Rerun code
    function submitInputs() {
        const inputs = Array.from(document.querySelectorAll(".user-input")).map(input => input.value);
        const code = editor.getValue();
        executeCode(code, inputs);
    }

    // Add event listener to run code button
    const runButton = document.querySelector(".run-btn");
    runButton.addEventListener('click', compileCode);
});</script>
</body>

</html>